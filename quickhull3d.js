var e={824:(e,t,n)=>{var r=n(785),i=n(220),o=n(594),a=[0,0,0];e.exports=function(e,t,n,s){return i(e,t,n),i(a,n,s),o(e,e,a),r(e,e)}},594:e=>{e.exports=function(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[0],s=n[1],c=n[2];return e[0]=i*c-o*s,e[1]=o*a-r*c,e[2]=r*s-i*a,e}},785:e=>{e.exports=function(e,t){var n=t[0],r=t[1],i=t[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o),e}},59:e=>{e.exports=function(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}},220:e=>{e.exports=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}},291:(e,t,n)=>{e.exports=function(e){var t=e.length;if(t<3){for(var n=new Array(t),i=0;i<t;++i)n[i]=i;return 2===t&&e[0][0]===e[1][0]&&e[0][1]===e[1][1]?[0]:n}var o=new Array(t);for(i=0;i<t;++i)o[i]=i;o.sort((function(t,n){return e[t][0]-e[n][0]||e[t][1]-e[n][1]}));var a=[o[0],o[1]],s=[o[0],o[1]];for(i=2;i<t;++i){for(var c=o[i],l=e[c],h=a.length;h>1&&r(e[a[h-2]],e[a[h-1]],l)<=0;)h-=1,a.pop();for(a.push(c),h=s.length;h>1&&r(e[s[h-2]],e[s[h-1]],l)>=0;)h-=1,s.pop();s.push(c)}n=new Array(s.length+a.length-2);for(var p=0,u=(i=0,a.length);i<u;++i)n[p++]=a[i];for(var d=s.length-2;d>0;--d)n[p++]=s[d];return n};var r=n(573)[3]},106:(e,t,n)=>{var r=n(903);e.exports=function(e,t,n){return Math.sqrt(r(e,t,n))}},903:(e,t,n)=>{var r=n(220),i=n(594),o=n(59),a=[],s=[],c=[];e.exports=function(e,t,n){r(a,n,t),r(s,e,t);var l=o(i(c,s,a)),h=o(a);if(0===h)throw Error("a and b are the same point");return l/h}},573:(e,t,n)=>{var r=n(383),i=n(951),o=n(297),a=n(916);function s(e,t,n,r){return function(n,i,o){var a=e(e(t(i[1],o[0]),t(-o[1],i[0])),e(t(n[1],i[0]),t(-i[1],n[0]))),s=e(t(n[1],o[0]),t(-o[1],n[0])),c=r(a,s);return c[c.length-1]}}function c(e,t,n,r){return function(i,o,a,s){var c=e(e(n(e(t(a[1],s[0]),t(-s[1],a[0])),o[2]),e(n(e(t(o[1],s[0]),t(-s[1],o[0])),-a[2]),n(e(t(o[1],a[0]),t(-a[1],o[0])),s[2]))),e(n(e(t(o[1],s[0]),t(-s[1],o[0])),i[2]),e(n(e(t(i[1],s[0]),t(-s[1],i[0])),-o[2]),n(e(t(i[1],o[0]),t(-o[1],i[0])),s[2])))),l=e(e(n(e(t(a[1],s[0]),t(-s[1],a[0])),i[2]),e(n(e(t(i[1],s[0]),t(-s[1],i[0])),-a[2]),n(e(t(i[1],a[0]),t(-a[1],i[0])),s[2]))),e(n(e(t(o[1],a[0]),t(-a[1],o[0])),i[2]),e(n(e(t(i[1],a[0]),t(-a[1],i[0])),-o[2]),n(e(t(i[1],o[0]),t(-o[1],i[0])),a[2])))),h=r(c,l);return h[h.length-1]}}function l(e,t,n,r){return function(i,o,a,s,c){var l=e(e(e(n(e(n(e(t(s[1],c[0]),t(-c[1],s[0])),a[2]),e(n(e(t(a[1],c[0]),t(-c[1],a[0])),-s[2]),n(e(t(a[1],s[0]),t(-s[1],a[0])),c[2]))),o[3]),e(n(e(n(e(t(s[1],c[0]),t(-c[1],s[0])),o[2]),e(n(e(t(o[1],c[0]),t(-c[1],o[0])),-s[2]),n(e(t(o[1],s[0]),t(-s[1],o[0])),c[2]))),-a[3]),n(e(n(e(t(a[1],c[0]),t(-c[1],a[0])),o[2]),e(n(e(t(o[1],c[0]),t(-c[1],o[0])),-a[2]),n(e(t(o[1],a[0]),t(-a[1],o[0])),c[2]))),s[3]))),e(n(e(n(e(t(a[1],s[0]),t(-s[1],a[0])),o[2]),e(n(e(t(o[1],s[0]),t(-s[1],o[0])),-a[2]),n(e(t(o[1],a[0]),t(-a[1],o[0])),s[2]))),-c[3]),e(n(e(n(e(t(s[1],c[0]),t(-c[1],s[0])),o[2]),e(n(e(t(o[1],c[0]),t(-c[1],o[0])),-s[2]),n(e(t(o[1],s[0]),t(-s[1],o[0])),c[2]))),i[3]),n(e(n(e(t(s[1],c[0]),t(-c[1],s[0])),i[2]),e(n(e(t(i[1],c[0]),t(-c[1],i[0])),-s[2]),n(e(t(i[1],s[0]),t(-s[1],i[0])),c[2]))),-o[3])))),e(e(n(e(n(e(t(o[1],c[0]),t(-c[1],o[0])),i[2]),e(n(e(t(i[1],c[0]),t(-c[1],i[0])),-o[2]),n(e(t(i[1],o[0]),t(-o[1],i[0])),c[2]))),s[3]),e(n(e(n(e(t(o[1],s[0]),t(-s[1],o[0])),i[2]),e(n(e(t(i[1],s[0]),t(-s[1],i[0])),-o[2]),n(e(t(i[1],o[0]),t(-o[1],i[0])),s[2]))),-c[3]),n(e(n(e(t(a[1],s[0]),t(-s[1],a[0])),o[2]),e(n(e(t(o[1],s[0]),t(-s[1],o[0])),-a[2]),n(e(t(o[1],a[0]),t(-a[1],o[0])),s[2]))),i[3]))),e(n(e(n(e(t(a[1],s[0]),t(-s[1],a[0])),i[2]),e(n(e(t(i[1],s[0]),t(-s[1],i[0])),-a[2]),n(e(t(i[1],a[0]),t(-a[1],i[0])),s[2]))),-o[3]),e(n(e(n(e(t(o[1],s[0]),t(-s[1],o[0])),i[2]),e(n(e(t(i[1],s[0]),t(-s[1],i[0])),-o[2]),n(e(t(i[1],o[0]),t(-o[1],i[0])),s[2]))),a[3]),n(e(n(e(t(o[1],a[0]),t(-a[1],o[0])),i[2]),e(n(e(t(i[1],a[0]),t(-a[1],i[0])),-o[2]),n(e(t(i[1],o[0]),t(-o[1],i[0])),a[2]))),-s[3]))))),h=e(e(e(n(e(n(e(t(s[1],c[0]),t(-c[1],s[0])),a[2]),e(n(e(t(a[1],c[0]),t(-c[1],a[0])),-s[2]),n(e(t(a[1],s[0]),t(-s[1],a[0])),c[2]))),i[3]),n(e(n(e(t(s[1],c[0]),t(-c[1],s[0])),i[2]),e(n(e(t(i[1],c[0]),t(-c[1],i[0])),-s[2]),n(e(t(i[1],s[0]),t(-s[1],i[0])),c[2]))),-a[3])),e(n(e(n(e(t(a[1],c[0]),t(-c[1],a[0])),i[2]),e(n(e(t(i[1],c[0]),t(-c[1],i[0])),-a[2]),n(e(t(i[1],a[0]),t(-a[1],i[0])),c[2]))),s[3]),n(e(n(e(t(a[1],s[0]),t(-s[1],a[0])),i[2]),e(n(e(t(i[1],s[0]),t(-s[1],i[0])),-a[2]),n(e(t(i[1],a[0]),t(-a[1],i[0])),s[2]))),-c[3]))),e(e(n(e(n(e(t(a[1],c[0]),t(-c[1],a[0])),o[2]),e(n(e(t(o[1],c[0]),t(-c[1],o[0])),-a[2]),n(e(t(o[1],a[0]),t(-a[1],o[0])),c[2]))),i[3]),n(e(n(e(t(a[1],c[0]),t(-c[1],a[0])),i[2]),e(n(e(t(i[1],c[0]),t(-c[1],i[0])),-a[2]),n(e(t(i[1],a[0]),t(-a[1],i[0])),c[2]))),-o[3])),e(n(e(n(e(t(o[1],c[0]),t(-c[1],o[0])),i[2]),e(n(e(t(i[1],c[0]),t(-c[1],i[0])),-o[2]),n(e(t(i[1],o[0]),t(-o[1],i[0])),c[2]))),a[3]),n(e(n(e(t(o[1],a[0]),t(-a[1],o[0])),i[2]),e(n(e(t(i[1],a[0]),t(-a[1],i[0])),-o[2]),n(e(t(i[1],o[0]),t(-o[1],i[0])),a[2]))),-c[3])))),p=r(l,h);return p[p.length-1]}}function h(e){return(3===e?s:4===e?c:l)(i,r,o,a)}var p=h(3),u=h(4),d=[function(){return 0},function(){return 0},function(e,t){return t[0]-e[0]},function(e,t,n){var r,i=(e[1]-n[1])*(t[0]-n[0]),o=(e[0]-n[0])*(t[1]-n[1]),a=i-o;if(i>0){if(o<=0)return a;r=i+o}else{if(!(i<0))return a;if(o>=0)return a;r=-(i+o)}var s=33306690738754716e-32*r;return a>=s||a<=-s?a:p(e,t,n)},function(e,t,n,r){var i=e[0]-r[0],o=t[0]-r[0],a=n[0]-r[0],s=e[1]-r[1],c=t[1]-r[1],l=n[1]-r[1],h=e[2]-r[2],p=t[2]-r[2],d=n[2]-r[2],f=o*l,v=a*c,x=a*s,g=i*l,m=i*c,F=o*s,w=h*(f-v)+p*(x-g)+d*(m-F),A=7771561172376103e-31*((Math.abs(f)+Math.abs(v))*Math.abs(h)+(Math.abs(x)+Math.abs(g))*Math.abs(p)+(Math.abs(m)+Math.abs(F))*Math.abs(d));return w>A||-w>A?w:u(e,t,n,r)}];function f(e){var t=d[e.length];return t||(t=d[e.length]=h(e.length)),t.apply(void 0,e)}function v(e,t,n,r,i,o,a){return function(t,n,s,c,l){switch(arguments.length){case 0:case 1:return 0;case 2:return r(t,n);case 3:return i(t,n,s);case 4:return o(t,n,s,c);case 5:return a(t,n,s,c,l)}for(var h=new Array(arguments.length),p=0;p<arguments.length;++p)h[p]=arguments[p];return e(h)}}!function(){for(;d.length<=5;)d.push(h(d.length));e.exports=v.apply(void 0,[f].concat(d));for(var t=0;t<=5;++t)e.exports[t]=d[t]}()},297:(e,t,n)=>{var r=n(383),i=n(519);e.exports=function(e,t){var n=e.length;if(1===n){var o=r(e[0],t);return o[0]?o:[o[1]]}var a=new Array(2*n),s=[.1,.1],c=[.1,.1],l=0;r(e[0],t,s),s[0]&&(a[l++]=s[0]);for(var h=1;h<n;++h){r(e[h],t,c);var p=s[1];i(p,c[0],s),s[0]&&(a[l++]=s[0]);var u=c[1],d=s[1],f=u+d,v=d-(f-u);s[1]=f,v&&(a[l++]=v)}return s[1]&&(a[l++]=s[1]),0===l&&(a[l++]=0),a.length=l,a}},916:e=>{e.exports=function(e,t){var n=0|e.length,r=0|t.length;if(1===n&&1===r)return function(e,t){var n=e+t,r=n-e,i=e-(n-r)+(t-r);return i?[i,n]:[n]}(e[0],-t[0]);var i,o,a=new Array(n+r),s=0,c=0,l=0,h=Math.abs,p=e[c],u=h(p),d=-t[l],f=h(d);u<f?(o=p,(c+=1)<n&&(u=h(p=e[c]))):(o=d,(l+=1)<r&&(f=h(d=-t[l]))),c<n&&u<f||l>=r?(i=p,(c+=1)<n&&(u=h(p=e[c]))):(i=d,(l+=1)<r&&(f=h(d=-t[l])));for(var v,x,g=i+o,m=g-i,F=o-m,w=F,A=g;c<n&&l<r;)u<f?(i=p,(c+=1)<n&&(u=h(p=e[c]))):(i=d,(l+=1)<r&&(f=h(d=-t[l]))),(F=(o=w)-(m=(g=i+o)-i))&&(a[s++]=F),w=A-((v=A+g)-(x=v-A))+(g-x),A=v;for(;c<n;)(F=(o=w)-(m=(g=(i=p)+o)-i))&&(a[s++]=F),w=A-((v=A+g)-(x=v-A))+(g-x),A=v,(c+=1)<n&&(p=e[c]);for(;l<r;)(F=(o=w)-(m=(g=(i=d)+o)-i))&&(a[s++]=F),w=A-((v=A+g)-(x=v-A))+(g-x),A=v,(l+=1)<r&&(d=-t[l]);return w&&(a[s++]=w),A&&(a[s++]=A),s||(a[s++]=0),a.length=s,a}},951:e=>{e.exports=function(e,t){var n=0|e.length,r=0|t.length;if(1===n&&1===r)return function(e,t){var n=e+t,r=n-e,i=e-(n-r)+(t-r);return i?[i,n]:[n]}(e[0],t[0]);var i,o,a=new Array(n+r),s=0,c=0,l=0,h=Math.abs,p=e[c],u=h(p),d=t[l],f=h(d);u<f?(o=p,(c+=1)<n&&(u=h(p=e[c]))):(o=d,(l+=1)<r&&(f=h(d=t[l]))),c<n&&u<f||l>=r?(i=p,(c+=1)<n&&(u=h(p=e[c]))):(i=d,(l+=1)<r&&(f=h(d=t[l])));for(var v,x,g=i+o,m=g-i,F=o-m,w=F,A=g;c<n&&l<r;)u<f?(i=p,(c+=1)<n&&(u=h(p=e[c]))):(i=d,(l+=1)<r&&(f=h(d=t[l]))),(F=(o=w)-(m=(g=i+o)-i))&&(a[s++]=F),w=A-((v=A+g)-(x=v-A))+(g-x),A=v;for(;c<n;)(F=(o=w)-(m=(g=(i=p)+o)-i))&&(a[s++]=F),w=A-((v=A+g)-(x=v-A))+(g-x),A=v,(c+=1)<n&&(p=e[c]);for(;l<r;)(F=(o=w)-(m=(g=(i=d)+o)-i))&&(a[s++]=F),w=A-((v=A+g)-(x=v-A))+(g-x),A=v,(l+=1)<r&&(d=t[l]);return w&&(a[s++]=w),A&&(a[s++]=A),s||(a[s++]=0),a.length=s,a}},383:e=>{e.exports=function(e,n,r){var i=e*n,o=t*e,a=o-(o-e),s=e-a,c=t*n,l=c-(c-n),h=n-l,p=s*h-(i-a*l-s*l-a*h);return r?(r[0]=p,r[1]=i,r):[p,i]};var t=+(Math.pow(2,27)+1)},519:e=>{e.exports=function(e,t,n){var r=e+t,i=r-e,o=t-i,a=e-(r-i);return n?(n[0]=a+o,n[1]=r,n):[a+o,r]}}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r={};n.d(r,{Z1:()=>S,Nz:()=>L,Ay:()=>B,_p:()=>W});var i=n(824),o=n.n(i),a=n(106),s=n.n(a),c=n(291),l=n.n(c),h="undefined"!=typeof Float32Array?Float32Array:Array;function p(){var e=new h(3);return h!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function u(e){var t=e[0],n=e[1],r=e[2];return Math.hypot(t,n,r)}function d(e,t,n){var r=new h(3);return r[0]=e,r[1]=t,r[2]=n,r}function f(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function v(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function x(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function g(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function m(e,t){var n=t[0],r=t[1],i=t[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function F(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function w(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[0],s=n[1],c=n[2];return e[0]=i*c-o*s,e[1]=o*a-r*c,e[2]=r*s-i*a,e}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var A=u;function y(e,t,n,r){var i=new h(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i}function b(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,e[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,e[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,e[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,e}function M(){var e=new h(4);return h!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}p(),function(){var e;e=new h(4),h!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}();var V,T,N,E,P=(V=p(),T=d(1,0,0),N=d(0,1,0),function(e,t,n){var r=F(t,n);return r<-.999999?(w(V,T,t),A(V)<1e-6&&w(V,N,t),m(V,V),function(e,t,n){n*=.5;var r=Math.sin(n);e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n)}(e,V,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(w(V,t,n),e[0]=V[0],e[1]=V[1],e[2]=V[2],e[3]=1+r,function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=n*n+r*r+i*i+o*o;return a>0&&(a=1/Math.sqrt(a)),e[0]=n*a,e[1]=r*a,e[2]=i*a,e[3]=o*a,e}(e,e))});function C(){function e(){}return e.enabled=!1,e}M(),M(),E=new h(9),h!=Float32Array&&(E[1]=0,E[2]=0,E[3]=0,E[5]=0,E[6]=0,E[7]=0),E[0]=1,E[4]=1,E[8]=1;class k{head;tail;constructor(){this.head=null,this.tail=null}clear(){this.head=this.tail=null}insertBefore(e,t){t.prev=e.prev,t.next=e,t.prev?t.prev.next=t:this.head=t,e.prev=t}insertAfter(e,t){t.prev=e,t.next=e.next,t.next?t.next.prev=t:this.tail=t,e.next=t}add(e){this.head?this.tail.next=e:this.head=e,e.prev=this.tail,e.next=null,this.tail=e}addAll(e){for(this.head?this.tail.next=e:this.head=e,e.prev=this.tail;e.next;)e=e.next;this.tail=e}remove(e){e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev}removeChain(e,t){e.prev?e.prev.next=t.next:this.head=t.next,t.next?t.next.prev=e.prev:this.tail=e.prev}first(){return this.head}isEmpty(){return!this.head}}class O{point;index;next;prev;face;constructor(e,t){this.point=e,this.index=t,this.next=null,this.prev=null,this.face=null}}const I=C();class j{vertex;face;next;prev;opposite;constructor(e,t){this.vertex=e,this.face=t,this.next=null,this.prev=null,this.opposite=null}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){return this.tail()?(e=this.tail().point,t=this.head().point,n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],Math.hypot(n,r,i)):-1;var e,t,n,r,i}lengthSquared(){return this.tail()?(e=this.tail().point,t=this.head().point,n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],n*n+r*r+i*i):-1;var e,t,n,r,i}setOpposite(e){const t=this;I.enabled&&I(`opposite ${t.tail().index} <--\x3e ${t.head().index} between ${t.face.collectIndices()}, ${e.face.collectIndices()}`),this.opposite=e,e.opposite=this}}const H=C();var D;!function(e){e[e.Visible=0]="Visible",e[e.NonConvex=1]="NonConvex",e[e.Deleted=2]="Deleted"}(D||(D={}));class q{normal;centroid;offset;outside;mark;edge;nVertices;area;constructor(){this.normal=new Float32Array(3),this.centroid=new Float32Array(3),this.offset=0,this.outside=null,this.mark=D.Visible,this.edge=null,this.nVertices=0}getEdge(e){let t=this.edge;for(;e>0;)t=t.next,e-=1;for(;e<0;)t=t.prev,e+=1;return t}computeNormal(){const e=this.edge,t=e.next;let n=t.next;const r=x(new Float32Array(3),t.head().point,e.head().point),i=new Float32Array(3),o=new Float32Array(3);for(this.nVertices=2,this.normal=new Float32Array(3);n!==e;)f(o,r),x(r,n.head().point,e.head().point),v(this.normal,this.normal,w(i,o,r)),n=n.next,this.nVertices+=1;this.area=u(this.normal),this.normal=g(this.normal,this.normal,1/this.area)}computeNormalMinArea(e){if(this.computeNormal(),this.area<e){let e,t=0,n=this.edge;do{const r=n.lengthSquared();r>t&&(e=n,t=r),n=n.next}while(n!==this.edge);const r=e.tail().point,i=e.head().point,o=x(new Float32Array(3),i,r);g(o,o,1/Math.sqrt(t));const a=F(this.normal,o);!function(e,t,n,r){e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r}(this.normal,this.normal,o,-a),m(this.normal,this.normal)}}computeCentroid(){this.centroid=[0,0,0];let e=this.edge;do{v(this.centroid,this.centroid,e.head().point),e=e.next}while(e!==this.edge);g(this.centroid,this.centroid,1/this.nVertices)}computeNormalAndCentroid(e){void 0!==e?this.computeNormalMinArea(e):this.computeNormal(),this.computeCentroid(),this.offset=F(this.normal,this.centroid)}distanceToPlane(e){return F(this.normal,e)-this.offset}connectHalfEdges(e,t){let n;if(e.opposite.face===t.opposite.face){const r=t.opposite.face;let i;e===this.edge&&(this.edge=t),3===r.nVertices?(i=t.opposite.prev.opposite,r.mark=D.Deleted,n=r):(i=t.opposite.next,r.edge===i.prev&&(r.edge=i),i.prev=i.prev.prev,i.prev.next=i),t.prev=e.prev,t.prev.next=t,t.setOpposite(i),r.computeNormalAndCentroid()}else e.next=t,t.prev=e;return n}mergeAdjacentFaces(e,t){const n=e.opposite,r=n.face;t.push(r),r.mark=D.Deleted;let i,o,a=e.prev,s=e.next,c=n.prev,l=n.next;for(;a.opposite.face===r;)a=a.prev,l=l.next;for(;s.opposite.face===r;)s=s.next,c=c.prev;for(i=l;i!==c.next;i=i.next)i.face=this;return this.edge=s,o=this.connectHalfEdges(c,s),o&&t.push(o),o=this.connectHalfEdges(a,l),o&&t.push(o),this.computeNormalAndCentroid(),t}collectIndices(){const e=[];let t=this.edge;do{e.push(t.head().index),t=t.next}while(t!==this.edge);return e}static fromVertices(e,t=0){const n=new q,r=new j(e[0],n);let i=r;for(let t=1;t<e.length;t+=1){const r=new j(e[t],n);r.prev=i,i.next=r,i=r}return i.next=r,r.prev=i,n.edge=r,n.computeNormalAndCentroid(t),H.enabled&&H("face created %j",n.collectIndices()),n}static createTriangle(e,t,n,r=0){const i=new q,o=new j(e,i),a=new j(t,i),s=new j(n,i);return o.next=s.prev=a,a.next=o.prev=s,s.next=a.prev=o,i.edge=o,i.computeNormalAndCentroid(r),H.enabled&&H("face created %j",i.collectIndices()),i}}const $=C();var z;!function(e){e[e.NonConvexWrtLargerFace=0]="NonConvexWrtLargerFace",e[e.NonConvex=1]="NonConvex"}(z||(z={}));class L{skipTriangulation}class S{tolerance;faces;newFaces;claimed;unclaimed;vertices;discardedFaces;vertexPointIndices;constructor(e){if(!Array.isArray(e))throw TypeError("input is not a valid array");if(e.length<4)throw Error("cannot build a simplex out of <4 points");this.tolerance=-1,this.faces=[],this.newFaces=[],this.claimed=new k,this.unclaimed=new k,this.vertices=[];for(let t=0;t<e.length;t+=1)this.vertices.push(new O(e[t],t));this.discardedFaces=[],this.vertexPointIndices=[]}addVertexToFace(e,t){e.face=t,t.outside?this.claimed.insertBefore(t.outside,e):this.claimed.add(e),t.outside=e}removeVertexFromFace(e,t){e===t.outside&&(e.next&&e.next.face===t?t.outside=e.next:t.outside=null),this.claimed.remove(e)}removeAllVerticesFromFace(e){if(e.outside){let t=e.outside;for(;t.next&&t.next.face===e;)t=t.next;return this.claimed.removeChain(e.outside,t),t.next=null,e.outside}}deleteFaceVertices(e,t){const n=this.removeAllVerticesFromFace(e);if(n)if(t){let e;for(let r=n;r;r=e)e=r.next,t.distanceToPlane(r.point)>this.tolerance?this.addVertexToFace(r,t):this.unclaimed.add(r)}else this.unclaimed.addAll(n)}resolveUnclaimedPoints(e){let t=this.unclaimed.first();for(let n=t;n;n=t){t=n.next;let r,i=this.tolerance;for(let t=0;t<e.length;t+=1){const o=e[t];if(o.mark===D.Visible){const e=o.distanceToPlane(n.point);if(e>i&&(i=e,r=o),i>1e3*this.tolerance)break}}r&&this.addVertexToFace(n,r)}}allPointsBelongToPlane(e,t,n){const r=o()(new Float32Array(3),e.point,t.point,n.point);for(const e of this.vertices)if(F(e.point,r)>this.tolerance)return!1;return!0}convexHull2d(e,t,n){const r=o()(new Float32Array(3),e.point,t.point,n.point),i=P(new Float32Array(4),r,[0,1,0]),a=g(new Float32Array(3),r,-F(e.point,r)),s=function(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=r+r,c=i+i,l=o+o,h=r*s,p=r*c,u=r*l,d=i*c,f=i*l,v=o*l,x=a*s,g=a*c,m=a*l;return e[0]=1-(d+v),e[1]=p+m,e[2]=u-g,e[3]=0,e[4]=p-m,e[5]=1-(h+v),e[6]=f+x,e[7]=0,e[8]=u+g,e[9]=f-x,e[10]=1-(h+d),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}(new Float32Array(16),i,a),c=[];for(const e of this.vertices){const t=y(e.point[0],e.point[1],e.point[2],0),n=b(new Float32Array(4),t,s);$.enabled&&n[1]>this.tolerance&&$(`ERROR: point ${n} has an unexpected y value, it should be less than ${this.tolerance}`),c.push([n[0],n[2]])}const h=l()(c),p=[];for(const e of h)p.push(this.vertices[e]);const u=q.fromVertices(p);this.faces=[u]}computeTetrahedronExtremes(){const e=[],t=[],n=[],r=[];for(let e=0;e<3;e+=1)n[e]=r[e]=this.vertices[0];for(let n=0;n<3;n+=1)e[n]=t[n]=this.vertices[0].point[n];for(let i=1;i<this.vertices.length;i+=1){const o=this.vertices[i],a=o.point;for(let t=0;t<3;t+=1)a[t]<e[t]&&(e[t]=a[t],n[t]=o);for(let e=0;e<3;e+=1)a[e]>t[e]&&(t[e]=a[e],r[e]=o)}this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(e[0]),Math.abs(t[0]))+Math.max(Math.abs(e[1]),Math.abs(t[1]))+Math.max(Math.abs(e[2]),Math.abs(t[2]))),$.enabled&&$("tolerance %d",this.tolerance);let i=0,a=0;for(let e=0;e<3;e+=1){const t=r[e].point[e]-n[e].point[e];t>i&&(i=t,a=e)}const c=n[a],l=r[a];let h,p;i=0;for(let e=0;e<this.vertices.length;e+=1){const t=this.vertices[e];if(t!==c&&t!==l){const e=s()(t.point,c.point,l.point);e>i&&(i=e,h=t)}}const u=o()(new Float32Array(3),c.point,l.point,h.point),d=F(c.point,u);i=-1;for(let e=0;e<this.vertices.length;e+=1){const t=this.vertices[e];if(t!==c&&t!==l&&t!==h){const e=Math.abs(F(u,t.point)-d);e>i&&(i=e,p=t)}}return[c,l,h,p]}createInitialSimplex(e,t,n,r){const i=o()(new Float32Array(3),e.point,t.point,n.point),a=F(e.point,i),s=[];if(F(r.point,i)-a<0){s.push(q.createTriangle(e,t,n),q.createTriangle(r,t,e),q.createTriangle(r,n,t),q.createTriangle(r,e,n));for(let e=0;e<3;e+=1){const t=(e+1)%3;s[e+1].getEdge(2).setOpposite(s[0].getEdge(t)),s[e+1].getEdge(1).setOpposite(s[t+1].getEdge(0))}}else{s.push(q.createTriangle(e,n,t),q.createTriangle(r,e,t),q.createTriangle(r,t,n),q.createTriangle(r,n,e));for(let e=0;e<3;e+=1){const t=(e+1)%3;s[e+1].getEdge(2).setOpposite(s[0].getEdge((3-e)%3)),s[e+1].getEdge(0).setOpposite(s[t+1].getEdge(1))}}for(let e=0;e<4;e+=1)this.faces.push(s[e]);const c=this.vertices;for(let i=0;i<c.length;i+=1){const o=c[i];if(o!==e&&o!==t&&o!==n&&o!==r){let e,t=this.tolerance;for(let n=0;n<4;n+=1){const r=s[n].distanceToPlane(o.point);r>t&&(t=r,e=s[n])}e&&this.addVertexToFace(o,e)}}}reindexFaceAndVertices(){const e=[];for(let t=0;t<this.faces.length;t+=1){const n=this.faces[t];n.mark===D.Visible&&e.push(n)}this.faces=e}collectFaces(e){const t=[];for(let n=0;n<this.faces.length;n+=1){if(this.faces[n].mark!==D.Visible)throw Error("attempt to include a destroyed face in the hull");const r=this.faces[n].collectIndices();if(e)t.push(r);else for(let e=0;e<r.length-2;e+=1)t.push([r[0],r[e+1],r[e+2]])}return t}nextVertexToAdd(){if(!this.claimed.isEmpty()){let e,t,n=0;const r=this.claimed.first().face;for(t=r.outside;t&&t.face===r;t=t.next){const i=r.distanceToPlane(t.point);i>n&&(n=i,e=t)}return e}}computeHorizon(e,t,n,r){let i;this.deleteFaceVertices(n),n.mark=D.Deleted,i=t?t.next:t=n.getEdge(0);do{const t=i.opposite,n=t.face;n.mark===D.Visible&&(n.distanceToPlane(e)>this.tolerance?this.computeHorizon(e,t,n,r):r.push(i)),i=i.next}while(i!==t)}addAdjoiningFace(e,t){const n=q.createTriangle(e,t.tail(),t.head());return this.faces.push(n),n.getEdge(-1).setOpposite(t.opposite),n.getEdge(0)}addNewFaces(e,t){let n,r;this.newFaces=[];for(let i=0;i<t.length;i+=1){const o=t[i],a=this.addAdjoiningFace(e,o);n?a.next.setOpposite(r):n=a,this.newFaces.push(a.face),r=a}n.next.setOpposite(r)}oppositeFaceDistance(e){return e.face.distanceToPlane(e.opposite.face.centroid)}doAdjacentMerge(e,t){let n=e.edge,r=!0,i=0;do{if(i>=e.nVertices)throw Error("merge recursion limit exceeded");const o=n.opposite.face;let a=!1;if(t===z.NonConvex?(this.oppositeFaceDistance(n)>-this.tolerance||this.oppositeFaceDistance(n.opposite)>-this.tolerance)&&(a=!0):e.area>o.area?this.oppositeFaceDistance(n)>-this.tolerance?a=!0:this.oppositeFaceDistance(n.opposite)>-this.tolerance&&(r=!1):this.oppositeFaceDistance(n.opposite)>-this.tolerance?a=!0:this.oppositeFaceDistance(n)>-this.tolerance&&(r=!1),a){$("face merge");const t=e.mergeAdjacentFaces(n,[]);for(let n=0;n<t.length;n+=1)this.deleteFaceVertices(t[n],e);return!0}n=n.next,i+=1}while(n!==e.edge);return r||(e.mark=D.NonConvex),!1}addVertexToHull(e){const t=[];this.unclaimed.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),$.enabled&&$("horizon %j",t.map((function(e){return e.head().index}))),this.addNewFaces(e,t),$("first merge");for(let e=0;e<this.newFaces.length;e+=1){const t=this.newFaces[e];if(t.mark===D.Visible)for(;this.doAdjacentMerge(t,z.NonConvexWrtLargerFace););}$("second merge");for(let e=0;e<this.newFaces.length;e+=1){const t=this.newFaces[e];if(t.mark===D.NonConvex)for(t.mark=D.Visible;this.doAdjacentMerge(t,z.NonConvexWrtLargerFace););}$("reassigning points to newFaces"),this.resolveUnclaimedPoints(this.newFaces)}build(){let e,t=0;const[n,r,i,o]=this.computeTetrahedronExtremes();if(this.allPointsBelongToPlane(n,r,i))return this.convexHull2d(n,r,i),this;for(this.createInitialSimplex(n,r,i,o);e=this.nextVertexToAdd();)t+=1,$(`== iteration ${t} ==`),$("next vertex to add = %d %j",e.index,e.point),this.addVertexToHull(e),$(`== end iteration ${t}`);return this.reindexFaceAndVertices(),this}}function B(e,t={}){const n=new S(e);return n.build(),n.collectFaces(t.skipTriangulation)}function W(e,t,n){for(let r=0;r<n.length;r++){const i=n[r],a=t[i[0]],s=t[i[1]],c=t[i[2]],l=o()(new Float32Array(3),a,s,c),h=[e[0]-a[0],e[1]-a[1],e[2]-a[2]];if(l[0]*h[0]+l[1]*h[1]+l[2]*h[2]>0)return!1}return!0}var _=r.Z1,R=r.Nz,Q=r.Ay,U=r._p;export{_ as QuickHull,R as QuickHullOptions,Q as default,U as isPointInsideHull};
//# sourceMappingURL=quickhull3d.js.map