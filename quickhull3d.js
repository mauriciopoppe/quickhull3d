var e={7833:(e,t,n)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,s=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(r++,"%c"===e&&(s=r))})),t.splice(s,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=n(736)(t);const{formatters:r}=e.exports;r.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},736:(e,t,n)=>{e.exports=function(e){function t(e){let n,s,o,i=null;function a(...e){if(!a.enabled)return;const r=a,s=Number(new Date),o=s-(n||s);r.diff=o,r.prev=n,r.curr=s,n=s,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let i=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((n,s)=>{if("%%"===n)return"%";i++;const o=t.formatters[s];if("function"==typeof o){const t=e[i];n=o.call(r,t),e.splice(i,1),i--}return n})),t.formatArgs.call(r,e),(r.log||t.log).apply(r,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=r,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==i?i:(s!==t.namespaces&&(s=t.namespaces,o=t.enabled(e)),o),set:e=>{i=e}}),"function"==typeof t.init&&t.init(a),a}function r(e,n){const r=t(this.namespace+(void 0===n?":":n)+e);return r.log=this.log,r}function s(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(s),...t.skips.map(s).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let n;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),s=r.length;for(n=0;n<s;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(6585),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((n=>{t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t}},3824:(e,t,n)=>{var r=n(1785),s=n(220),o=n(3594),i=[0,0,0];e.exports=function(e,t,n,a){return s(e,t,n),s(i,n,a),o(e,e,i),r(e,e)}},3401:e=>{e.exports=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}},2573:(e,t,n)=>{e.exports=function(e,t){var n=r(e[0],e[1],e[2]),i=r(t[0],t[1],t[2]);s(n,n),s(i,i);var a=o(n,i);return a>1?0:Math.acos(a)};var r=n(3198),s=n(1785),o=n(409)},5421:e=>{e.exports=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}},6591:e=>{e.exports=function(e){var t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}},1589:e=>{e.exports=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}},1216:e=>{e.exports=function(){var e=new Float32Array(3);return e[0]=0,e[1]=0,e[2]=0,e}},3594:e=>{e.exports=function(e,t,n){var r=t[0],s=t[1],o=t[2],i=n[0],a=n[1],c=n[2];return e[0]=s*c-o*a,e[1]=o*i-r*c,e[2]=r*a-s*i,e}},1144:(e,t,n)=>{e.exports=n(8051)},8051:e=>{e.exports=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return Math.sqrt(n*n+r*r+s*s)}},2473:(e,t,n)=>{e.exports=n(5053)},5053:e=>{e.exports=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}},409:e=>{e.exports=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}},2864:e=>{e.exports=1e-6},8817:(e,t,n)=>{e.exports=function(e,t){var n=e[0],s=e[1],o=e[2],i=t[0],a=t[1],c=t[2];return Math.abs(n-i)<=r*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(s-a)<=r*Math.max(1,Math.abs(s),Math.abs(a))&&Math.abs(o-c)<=r*Math.max(1,Math.abs(o),Math.abs(c))};var r=n(2864)},4964:e=>{e.exports=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}},1380:e=>{e.exports=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}},1536:(e,t,n)=>{e.exports=function(e,t,n,s,o,i){var a,c;for(t||(t=3),n||(n=0),c=s?Math.min(s*t+n,e.length):e.length,a=n;a<c;a+=t)r[0]=e[a],r[1]=e[a+1],r[2]=e[a+2],o(r,r,i),e[a]=r[0],e[a+1]=r[1],e[a+2]=r[2];return e};var r=n(1216)()},3198:e=>{e.exports=function(e,t,n){var r=new Float32Array(3);return r[0]=e,r[1]=t,r[2]=n,r}},4226:(e,t,n)=>{e.exports={EPSILON:n(2864),create:n(1216),clone:n(6591),angle:n(2573),fromValues:n(3198),copy:n(1589),set:n(3618),equals:n(8817),exactEquals:n(4964),add:n(3401),subtract:n(220),sub:n(3636),multiply:n(6936),mul:n(728),divide:n(5053),div:n(2473),min:n(1374),max:n(9200),floor:n(1380),ceil:n(5421),round:n(5930),scale:n(3544),scaleAndAdd:n(4252),distance:n(8051),dist:n(1144),squaredDistance:n(4312),sqrDist:n(80),length:n(4136),len:n(9765),squaredLength:n(9059),sqrLen:n(4397),negate:n(5178),inverse:n(2286),normalize:n(1785),dot:n(409),cross:n(3594),lerp:n(1229),random:n(2811),transformMat4:n(3928),transformMat3:n(8317),transformQuat:n(2617),rotateX:n(1263),rotateY:n(8104),rotateZ:n(9137),forEach:n(1536)}},2286:e=>{e.exports=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}},9765:(e,t,n)=>{e.exports=n(4136)},4136:e=>{e.exports=function(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)}},1229:e=>{e.exports=function(e,t,n,r){var s=t[0],o=t[1],i=t[2];return e[0]=s+r*(n[0]-s),e[1]=o+r*(n[1]-o),e[2]=i+r*(n[2]-i),e}},9200:e=>{e.exports=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}},1374:e=>{e.exports=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}},728:(e,t,n)=>{e.exports=n(6936)},6936:e=>{e.exports=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}},5178:e=>{e.exports=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}},1785:e=>{e.exports=function(e,t){var n=t[0],r=t[1],s=t[2],o=n*n+r*r+s*s;return o>0&&(o=1/Math.sqrt(o),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o),e}},2811:e=>{e.exports=function(e,t){t=t||1;var n=2*Math.random()*Math.PI,r=2*Math.random()-1,s=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*s,e[1]=Math.sin(n)*s,e[2]=r*t,e}},1263:e=>{e.exports=function(e,t,n,r){var s=n[1],o=n[2],i=t[1]-s,a=t[2]-o,c=Math.sin(r),l=Math.cos(r);return e[0]=t[0],e[1]=s+i*l-a*c,e[2]=o+i*c+a*l,e}},8104:e=>{e.exports=function(e,t,n,r){var s=n[0],o=n[2],i=t[0]-s,a=t[2]-o,c=Math.sin(r),l=Math.cos(r);return e[0]=s+a*c+i*l,e[1]=t[1],e[2]=o+a*l-i*c,e}},9137:e=>{e.exports=function(e,t,n,r){var s=n[0],o=n[1],i=t[0]-s,a=t[1]-o,c=Math.sin(r),l=Math.cos(r);return e[0]=s+i*l-a*c,e[1]=o+i*c+a*l,e[2]=t[2],e}},5930:e=>{e.exports=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}},3544:e=>{e.exports=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}},4252:e=>{e.exports=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}},3618:e=>{e.exports=function(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}},80:(e,t,n)=>{e.exports=n(4312)},4397:(e,t,n)=>{e.exports=n(9059)},4312:e=>{e.exports=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return n*n+r*r+s*s}},9059:e=>{e.exports=function(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}},3636:(e,t,n)=>{e.exports=n(220)},220:e=>{e.exports=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}},8317:e=>{e.exports=function(e,t,n){var r=t[0],s=t[1],o=t[2];return e[0]=r*n[0]+s*n[3]+o*n[6],e[1]=r*n[1]+s*n[4]+o*n[7],e[2]=r*n[2]+s*n[5]+o*n[8],e}},3928:e=>{e.exports=function(e,t,n){var r=t[0],s=t[1],o=t[2],i=n[3]*r+n[7]*s+n[11]*o+n[15];return i=i||1,e[0]=(n[0]*r+n[4]*s+n[8]*o+n[12])/i,e[1]=(n[1]*r+n[5]*s+n[9]*o+n[13])/i,e[2]=(n[2]*r+n[6]*s+n[10]*o+n[14])/i,e}},2617:e=>{e.exports=function(e,t,n){var r=t[0],s=t[1],o=t[2],i=n[0],a=n[1],c=n[2],l=n[3],h=l*r+a*o-c*s,d=l*s+c*r-i*o,u=l*o+i*s-a*r,p=-i*r-a*s-c*o;return e[0]=h*l+p*-i+d*-c-u*-a,e[1]=d*l+p*-a+u*-i-h*-c,e[2]=u*l+p*-c+h*-a-d*-i,e}},6585:e=>{var t=1e3,n=60*t,r=60*n,s=24*r,o=7*s;function i(e,t,n,r){var s=t>=1.5*n;return Math.round(e/n)+" "+r+(s?"s":"")}e.exports=function(e,a){a=a||{};var c,l,h=typeof e;if("string"===h&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var i=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(i){var a=parseFloat(i[1]);switch((i[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*a;case"weeks":case"week":case"w":return a*o;case"days":case"day":case"d":return a*s;case"hours":case"hour":case"hrs":case"hr":case"h":return a*r;case"minutes":case"minute":case"mins":case"min":case"m":return a*n;case"seconds":case"second":case"secs":case"sec":case"s":return a*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}}}(e);if("number"===h&&isFinite(e))return a.long?(c=e,(l=Math.abs(c))>=s?i(c,l,s,"day"):l>=r?i(c,l,r,"hour"):l>=n?i(c,l,n,"minute"):l>=t?i(c,l,t,"second"):c+" ms"):function(e){var o=Math.abs(e);return o>=s?Math.round(e/s)+"d":o>=r?Math.round(e/r)+"h":o>=n?Math.round(e/n)+"m":o>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},1106:(e,t,n)=>{var r=n(8903);e.exports=function(e,t,n){return Math.sqrt(r(e,t,n))}},8903:(e,t,n)=>{var r=n(220),s=n(3594),o=n(9059),i=[],a=[],c=[];e.exports=function(e,t,n){r(i,n,t),r(a,e,t);var l=o(s(c,a,i)),h=o(i);if(0===h)throw Error("a and b are the same point");return l/h}}},t={};function n(r){var s=t[r];if(void 0!==s)return s.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r={};n.d(r,{Z1:()=>v,Ay:()=>C,_p:()=>F});var s=n(3824),o=n.n(s),i=n(1106),a=n.n(i),c=n(4226);class l{head;tail;constructor(){this.head=null,this.tail=null}clear(){this.head=this.tail=null}insertBefore(e,t){t.prev=e.prev,t.next=e,t.prev?t.prev.next=t:this.head=t,e.prev=t}insertAfter(e,t){t.prev=e,t.next=e.next,t.next?t.next.prev=t:this.tail=t,e.next=t}add(e){this.head?this.tail.next=e:this.head=e,e.prev=this.tail,e.next=null,this.tail=e}addAll(e){for(this.head?this.tail.next=e:this.head=e,e.prev=this.tail;e.next;)e=e.next;this.tail=e}remove(e){e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev}removeChain(e,t){e.prev?e.prev.next=t.next:this.head=t.next,t.next?t.next.prev=e.prev:this.tail=e.prev}first(){return this.head}isEmpty(){return!this.head}}class h{point;index;next;prev;face;constructor(e,t){this.point=e,this.index=t,this.next=null,this.prev=null,this.face=null}}const d=n(7833)("halfedge");class u{vertex;face;next;prev;opposite;constructor(e,t){this.vertex=e,this.face=t,this.next=null,this.prev=null,this.opposite=null}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){return this.tail()?(0,c.distance)(this.tail().point,this.head().point):-1}lengthSquared(){return this.tail()?(0,c.squaredDistance)(this.tail().point,this.head().point):-1}setOpposite(e){const t=this;d.enabled&&d(`opposite ${t.tail().index} <--\x3e ${t.head().index} between ${t.face.collectIndices()}, ${e.face.collectIndices()}`),this.opposite=e,e.opposite=this}}const p=n(7833)("face");var f;!function(e){e[e.Visible=0]="Visible",e[e.NonConvex=1]="NonConvex",e[e.Deleted=2]="Deleted"}(f||(f={}));class m{normal;centroid;offset;outside;mark;edge;nVertices;area;constructor(){this.normal=[-1,-1,-1],this.centroid=[-1,-1,-1],this.offset=0,this.outside=null,this.mark=f.Visible,this.edge=null,this.nVertices=0}getEdge(e){let t=this.edge;for(;e>0;)t=t.next,e-=1;for(;e<0;)t=t.prev,e+=1;return t}computeNormal(){const e=this.edge,t=e.next;let n=t.next;const r=(0,c.subtract)([],t.head().point,e.head().point),s=[],o=[];for(this.nVertices=2,this.normal=[0,0,0];n!==e;)(0,c.copy)(o,r),(0,c.subtract)(r,n.head().point,e.head().point),(0,c.add)(this.normal,this.normal,(0,c.cross)(s,o,r)),n=n.next,this.nVertices+=1;this.area=(0,c.length)(this.normal),this.normal=(0,c.scale)(this.normal,this.normal,1/this.area)}computeNormalMinArea(e){if(this.computeNormal(),this.area<e){let e,t=0,n=this.edge;do{const r=n.lengthSquared();r>t&&(e=n,t=r),n=n.next}while(n!==this.edge);const r=e.tail().point,s=e.head().point,o=(0,c.subtract)([],s,r),i=Math.sqrt(t);(0,c.scale)(o,o,1/i);const a=(0,c.dot)(this.normal,o);(0,c.scaleAndAdd)(this.normal,this.normal,o,-a),(0,c.normalize)(this.normal,this.normal)}}computeCentroid(){this.centroid=[0,0,0];let e=this.edge;do{(0,c.add)(this.centroid,this.centroid,e.head().point),e=e.next}while(e!==this.edge);(0,c.scale)(this.centroid,this.centroid,1/this.nVertices)}computeNormalAndCentroid(e){void 0!==e?this.computeNormalMinArea(e):this.computeNormal(),this.computeCentroid(),this.offset=(0,c.dot)(this.normal,this.centroid)}distanceToPlane(e){return(0,c.dot)(this.normal,e)-this.offset}connectHalfEdges(e,t){let n;if(e.opposite.face===t.opposite.face){const r=t.opposite.face;let s;e===this.edge&&(this.edge=t),3===r.nVertices?(s=t.opposite.prev.opposite,r.mark=f.Deleted,n=r):(s=t.opposite.next,r.edge===s.prev&&(r.edge=s),s.prev=s.prev.prev,s.prev.next=s),t.prev=e.prev,t.prev.next=t,t.setOpposite(s),r.computeNormalAndCentroid()}else e.next=t,t.prev=e;return n}mergeAdjacentFaces(e,t){const n=e.opposite,r=n.face;t.push(r),r.mark=f.Deleted;let s,o,i=e.prev,a=e.next,c=n.prev,l=n.next;for(;i.opposite.face===r;)i=i.prev,l=l.next;for(;a.opposite.face===r;)a=a.next,c=c.prev;for(s=l;s!==c.next;s=s.next)s.face=this;return this.edge=a,o=this.connectHalfEdges(c,a),o&&t.push(o),o=this.connectHalfEdges(i,l),o&&t.push(o),this.computeNormalAndCentroid(),t}collectIndices(){const e=[];let t=this.edge;do{e.push(t.head().index),t=t.next}while(t!==this.edge);return e}static createTriangle(e,t,n,r=0){const s=new m,o=new u(e,s),i=new u(t,s),a=new u(n,s);return o.next=a.prev=i,i.next=o.prev=a,a.next=i.prev=o,s.edge=o,s.computeNormalAndCentroid(r),p.enabled&&p("face created %j",s.collectIndices()),s}}const x=n(7833)("quickhull");var g;!function(e){e[e.NonConvexWrtLargerFace=0]="NonConvexWrtLargerFace",e[e.NonConvex=1]="NonConvex"}(g||(g={}));class v{tolerance;faces;newFaces;claimed;unclaimed;vertices;discardedFaces;vertexPointIndices;constructor(e){if(!Array.isArray(e))throw TypeError("input is not a valid array");if(e.length<4)throw Error("cannot build a simplex out of <4 points");this.tolerance=-1,this.faces=[],this.newFaces=[],this.claimed=new l,this.unclaimed=new l,this.vertices=[];for(let t=0;t<e.length;t+=1)this.vertices.push(new h(e[t],t));this.discardedFaces=[],this.vertexPointIndices=[]}addVertexToFace(e,t){e.face=t,t.outside?this.claimed.insertBefore(t.outside,e):this.claimed.add(e),t.outside=e}removeVertexFromFace(e,t){e===t.outside&&(e.next&&e.next.face===t?t.outside=e.next:t.outside=null),this.claimed.remove(e)}removeAllVerticesFromFace(e){if(e.outside){let t=e.outside;for(;t.next&&t.next.face===e;)t=t.next;return this.claimed.removeChain(e.outside,t),t.next=null,e.outside}}deleteFaceVertices(e,t){const n=this.removeAllVerticesFromFace(e);if(n)if(t){let e;for(let r=n;r;r=e)e=r.next,t.distanceToPlane(r.point)>this.tolerance?this.addVertexToFace(r,t):this.unclaimed.add(r)}else this.unclaimed.addAll(n)}resolveUnclaimedPoints(e){let t=this.unclaimed.first();for(let n=t;n;n=t){t=n.next;let r,s=this.tolerance;for(let t=0;t<e.length;t+=1){const o=e[t];if(o.mark===f.Visible){const e=o.distanceToPlane(n.point);if(e>s&&(s=e,r=o),s>1e3*this.tolerance)break}}r&&this.addVertexToFace(n,r)}}computeExtremes(){const e=[],t=[],n=[],r=[];for(let e=0;e<3;e+=1)n[e]=r[e]=this.vertices[0];for(let n=0;n<3;n+=1)e[n]=t[n]=this.vertices[0].point[n];for(let s=1;s<this.vertices.length;s+=1){const o=this.vertices[s],i=o.point;for(let t=0;t<3;t+=1)i[t]<e[t]&&(e[t]=i[t],n[t]=o);for(let e=0;e<3;e+=1)i[e]>t[e]&&(t[e]=i[e],r[e]=o)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(e[0]),Math.abs(t[0]))+Math.max(Math.abs(e[1]),Math.abs(t[1]))+Math.max(Math.abs(e[2]),Math.abs(t[2]))),x.enabled&&x("tolerance %d",this.tolerance),[n,r]}createInitialSimplex(){const e=this.vertices,[t,n]=this.computeExtremes();let r=0,s=0;for(let e=0;e<3;e+=1){const o=n[e].point[e]-t[e].point[e];o>r&&(r=o,s=e)}const i=t[s],l=n[s];let h,d;r=0;for(let e=0;e<this.vertices.length;e+=1){const t=this.vertices[e];if(t!==i&&t!==l){const e=a()(t.point,i.point,l.point);e>r&&(r=e,h=t)}}const u=o()([],i.point,l.point,h.point),p=(0,c.dot)(i.point,u);r=-1;for(let e=0;e<this.vertices.length;e+=1){const t=this.vertices[e];if(t!==i&&t!==l&&t!==h){const e=Math.abs((0,c.dot)(u,t.point)-p);e>r&&(r=e,d=t)}}const f=[];if((0,c.dot)(d.point,u)-p<0){f.push(m.createTriangle(i,l,h),m.createTriangle(d,l,i),m.createTriangle(d,h,l),m.createTriangle(d,i,h));for(let e=0;e<3;e+=1){const t=(e+1)%3;f[e+1].getEdge(2).setOpposite(f[0].getEdge(t)),f[e+1].getEdge(1).setOpposite(f[t+1].getEdge(0))}}else{f.push(m.createTriangle(i,h,l),m.createTriangle(d,i,l),m.createTriangle(d,l,h),m.createTriangle(d,h,i));for(let e=0;e<3;e+=1){const t=(e+1)%3;f[e+1].getEdge(2).setOpposite(f[0].getEdge((3-e)%3)),f[e+1].getEdge(0).setOpposite(f[t+1].getEdge(1))}}for(let e=0;e<4;e+=1)this.faces.push(f[e]);for(let t=0;t<e.length;t+=1){const n=e[t];if(n!==i&&n!==l&&n!==h&&n!==d){let e;r=this.tolerance;for(let t=0;t<4;t+=1){const s=f[t].distanceToPlane(n.point);s>r&&(r=s,e=f[t])}e&&this.addVertexToFace(n,e)}}}reindexFaceAndVertices(){const e=[];for(let t=0;t<this.faces.length;t+=1){const n=this.faces[t];n.mark===f.Visible&&e.push(n)}this.faces=e}collectFaces(e){const t=[];for(let n=0;n<this.faces.length;n+=1){if(this.faces[n].mark!==f.Visible)throw Error("attempt to include a destroyed face in the hull");const r=this.faces[n].collectIndices();if(e)t.push(r);else for(let e=0;e<r.length-2;e+=1)t.push([r[0],r[e+1],r[e+2]])}return t}nextVertexToAdd(){if(!this.claimed.isEmpty()){let e,t,n=0;const r=this.claimed.first().face;for(t=r.outside;t&&t.face===r;t=t.next){const s=r.distanceToPlane(t.point);s>n&&(n=s,e=t)}return e}}computeHorizon(e,t,n,r){let s;this.deleteFaceVertices(n),n.mark=f.Deleted,s=t?t.next:t=n.getEdge(0);do{const t=s.opposite,n=t.face;n.mark===f.Visible&&(n.distanceToPlane(e)>this.tolerance?this.computeHorizon(e,t,n,r):r.push(s)),s=s.next}while(s!==t)}addAdjoiningFace(e,t){const n=m.createTriangle(e,t.tail(),t.head());return this.faces.push(n),n.getEdge(-1).setOpposite(t.opposite),n.getEdge(0)}addNewFaces(e,t){let n,r;this.newFaces=[];for(let s=0;s<t.length;s+=1){const o=t[s],i=this.addAdjoiningFace(e,o);n?i.next.setOpposite(r):n=i,this.newFaces.push(i.face),r=i}n.next.setOpposite(r)}oppositeFaceDistance(e){return e.face.distanceToPlane(e.opposite.face.centroid)}doAdjacentMerge(e,t){let n=e.edge,r=!0,s=0;do{if(s>=e.nVertices)throw Error("merge recursion limit exceeded");const o=n.opposite.face;let i=!1;if(t===g.NonConvex?(this.oppositeFaceDistance(n)>-this.tolerance||this.oppositeFaceDistance(n.opposite)>-this.tolerance)&&(i=!0):e.area>o.area?this.oppositeFaceDistance(n)>-this.tolerance?i=!0:this.oppositeFaceDistance(n.opposite)>-this.tolerance&&(r=!1):this.oppositeFaceDistance(n.opposite)>-this.tolerance?i=!0:this.oppositeFaceDistance(n)>-this.tolerance&&(r=!1),i){x("face merge");const t=e.mergeAdjacentFaces(n,[]);for(let n=0;n<t.length;n+=1)this.deleteFaceVertices(t[n],e);return!0}n=n.next,s+=1}while(n!==e.edge);return r||(e.mark=f.NonConvex),!1}addVertexToHull(e){const t=[];this.unclaimed.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),x.enabled&&x("horizon %j",t.map((function(e){return e.head().index}))),this.addNewFaces(e,t),x("first merge");for(let e=0;e<this.newFaces.length;e+=1){const t=this.newFaces[e];if(t.mark===f.Visible)for(;this.doAdjacentMerge(t,g.NonConvexWrtLargerFace););}x("second merge");for(let e=0;e<this.newFaces.length;e+=1){const t=this.newFaces[e];if(t.mark===f.NonConvex)for(t.mark=f.Visible;this.doAdjacentMerge(t,g.NonConvexWrtLargerFace););}x("reassigning points to newFaces"),this.resolveUnclaimedPoints(this.newFaces)}build(){let e,t=0;for(this.createInitialSimplex();e=this.nextVertexToAdd();)t+=1,x("== iteration %j ==",t),x("next vertex to add = %d %j",e.index,e.point),this.addVertexToHull(e),x("end");this.reindexFaceAndVertices()}}function C(e,t={}){const n=new v(e);return n.build(),n.collectFaces(t.skipTriangulation)}function F(e,t,n){for(let r=0;r<n.length;r++){const s=n[r],i=t[s[0]],a=t[s[1]],c=t[s[2]],l=o()([],i,a,c),h=[e[0]-i[0],e[1]-i[1],e[2]-i[2]];if(l[0]*h[0]+l[1]*h[1]+l[2]*h[2]>0)return!1}return!0}var b=r.Z1,w=r.Ay,M=r._p;export{b as QuickHull,w as default,M as isPointInsideHull};
//# sourceMappingURL=quickhull3d.js.map